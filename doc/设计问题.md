## 位置信息的获取

pd服务存放grain的位置信息，客户端向pd发送获取位置请求时，如果grain尚未激活，pd将选择一个silo地址返回给客户端。客户端缓存这个地址并用于后续请求。

silo接到对grain的请求，如果grain在本地不存在，silo请求pd用自己的地址Activate。如果此时grain在pd中尚不存在激活信息，或者激活地址就是请求silo本身，Activate返回成功。当前silo继续执行对grain的请求。否则，Activate返回失败，并附带grain所在silo地址，当前silo向请求方返回重定向错误。

### 问题1 pd在分配silo时并没有锁定grain的地址，地址是在silo执行Activate时锁定

假设grain:1不存在，同一时刻发出多个对grain:1的获取位置请求。此时pd可能对不同的请求选择不同的silo。因为Activate的排他性，这不会影响正确性。

如想避免这个问题，pd可以将第一个选择的silo缓存下来，后续短时间内的请求继续返回这个silo地址。

### 问题2 客户端缓存地址

如果客户端缓存了过期的地址信息，当请求发送给错误的silo，执行Activate时将会产生重定向错误，客户端处理这个错误刷新本地缓存。

考虑如下情况，客户端缓存了grain:1的地址silo:1。 之后silo:1下线，grian:1在silo:2重新激活。

客户端不知道这个情况，之后的继续向silo:1发送请求，因为silo:1已经下线，将无法响应请求。

1. 请求设置超时，发生超时的时候执行位置缓存清除。次方式仅对调用有效，对于单向调用无需等待响应。

2. 本地缓存设置超时时间，超时后失效。

超时时间选择很重要，太长了影响调用，太短了，导致频繁访问pd。










